<!doctype html>
<html>
<head>
    <title>GREPhub</title>
    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.6/css/materialize.min.css">
     <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="/stylesheets/appstyle.css">
</head>
<body>
    <!-- NAV BAR -->
    <nav class='teal'>
        <div class="nav-wrapper">
          <a class="brand-logo">GREPhub</a>
          <ul id="nav-mobile" class="right hide-on-med-and-down">
            <!-- <li><i class='medium material-icons red-power'>power_settings_new</i></li> -->
            <li><a href="/logout">Logout</a></li>
          </ul>
        </div>
    </nav>
    <!-- END NAV BAR -->

    <div class='row main-call-status'>
        <div class='col s12'>
            <h4 class='call-status col s3'>Waiting...</h4>
            <span><h5 class='current-agent col s1 push-s8'><%= agent %></h5></span>
        </div>
        <hr>
    </div>

    <div class='row'>
        <div class='col s8 main-script'>
            <div class='current-call-main'>
                <i class='large material-icons waiting-phone'>settings_phone</i>
            </div>
            <div class='js-hang-up'>
            </div>
        </div>

        <div class='col s4 main-info'>
            
        </div>

    </div>

    <!-- display call status in this paragraph tag -->

 
    <!-- include the Twilio Client JavaScript SDK -->
    <script src="//static.twilio.com/libs/twiliojs/1.1/twilio.min.js"></script>
 
    <!-- include jQuery to make DOM manipulation and event handling nicer -->
    <script src="//code.jquery.com/jquery-1.9.1.min.js"></script>
 
    <!-- accept incoming calls to this client -->
    <script type="text/javascript">
        // Set up the Twilio "Device" (think of it as the browser's phone) with
        // our server-generated capability token, which will be inserted by the
        // EJS template system:
        Twilio.Device.setup('<%= token %>');

        // $('.current-agent').html('<%= token.agent %>');
        
        // Register an event handler to be called when there is an incoming
        // call:
        Twilio.Device.incoming(function(connection) {
            //For demo purposed, automatically accept the call
            connection.accept();
            $('.call-status').html('Call in progress...');

            $('.js-hang-up').html('<button id="hangup" class="waves-effect waves-light btn red darken-2">Hang Up</button>');
        });

 
        // Register an event handler for when a call ends for any reason
        Twilio.Device.disconnect(function(connection) {
            $('.call-status').html('Waiting...');
        });
 
        // Add a click event for the button, which will hang up the current
        // call when clicked:
        $('.js-hang-up').click(function() {
            Twilio.Device.disconnectAll();

            $('.js-hang-up').empty();

            $('.current-call-main').html('<i class="large material-icons waiting-phone">settings_phone</i>');
        });


        // Make an outbound call to the number given in the text field:
        $('#call').on('click', function() {
            // The properties of this object will be sent as POST
            // Parameters to URL which generates TwiML.
            Twilio.Device.connect({
                CallerId:'+14505556677', // Replace this value with a verified Twilio number:
                                         // https://www.twilio.com/user/account/phone-numbers/verified
                PhoneNumber:$('#number').val() //pass in the value of the text field
            });
        });
    </script>
     <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.6/js/materialize.min.js"></script>
</body>
</html>